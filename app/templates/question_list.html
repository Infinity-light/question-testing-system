{% extends "base.html" %}

{% block title %}问题列表 - AI问题测试系统{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h2>问题列表</h2>
    </div>
    <div class="col-md-4 text-end">
        <a href="{{ url_for('questions.new_question') }}" class="btn btn-primary">添加新问题</a>
    </div>
</div>

<!-- Filters -->
<div class="card mb-4">
    <div class="card-body">
        <form method="GET" class="row g-3">
            <div class="col-md-3">
                <label for="subject" class="form-label">领域</label>
                <select class="form-select" id="subject" name="subject" onchange="this.form.submit()">
                    <option value="">全部</option>
                    {% for subj in subjects %}
                        <option value="{{ subj }}" {{ 'selected' if subj == current_subject else '' }}>{{ subj }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label for="difficulty" class="form-label">难度</label>
                <select class="form-select" id="difficulty" name="difficulty" onchange="this.form.submit()">
                    <option value="">全部</option>
                    {% for diff in difficulties %}
                        <option value="{{ diff }}" {{ 'selected' if diff == current_difficulty else '' }}>{{ diff }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label for="submitter" class="form-label">提交者姓名</label>
                <select class="form-select" id="submitter" name="submitter" onchange="this.form.submit()">
                    <option value="">全部</option>
                    {% for sub in submitters %}
                        <option value="{{ sub }}" {{ 'selected' if sub == current_submitter else '' }}>{{ sub }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <a href="{{ url_for('questions.index') }}" class="btn btn-secondary">清除筛选</a>
            </div>
        </form>
    </div>
</div>

<!-- Questions Table -->
{% if questions %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>标题</th>
                <th>类型</th>
                <th>领域</th>
                <th>难度</th>
                <th>知识点</th>
                <th>提交者姓名</th>
                <th>创建时间</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {% for question in questions %}
            <tr>
                <td>{{ question.id }}</td>
                <td>{{ question.title }}</td>
                <td>{{ question.question_type }}</td>
                <td>{{ question.subject }}</td>
                <td>{{ question.difficulty }}</td>
                <td>{{ question.knowledge_points[:50] }}{{ '...' if question.knowledge_points|length > 50 else '' }}</td>
                <td>{{ question.author.real_name }}</td>
                <td>{{ question.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="{{ url_for('questions.view_question', question_id=question.id) }}"
                           class="btn btn-info" title="查看">查看</a>
                        <a href="{{ url_for('questions.edit_question', question_id=question.id) }}"
                           class="btn btn-warning" title="编辑">编辑</a>
                        <form method="POST" action="{{ url_for('testing.run_test_sync', question_id=question.id) }}"
                              style="display: inline;">
                            <button type="submit" class="btn btn-success" title="运行测试">测试</button>
                        </form>
                        <form method="POST" action="{{ url_for('questions.delete_question', question_id=question.id) }}"
                              onsubmit="return confirm('确定要删除这个问题吗？')" style="display: inline;">
                            <button type="submit" class="btn btn-danger" title="删除">删除</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info">
    没有找到问题。<a href="{{ url_for('questions.new_question') }}">添加第一个问题</a>
</div>
{% endif %}

<div class="mt-3">
    <p class="text-muted">共 {{ questions|length }} 个问题</p>
</div>
{% endblock %}
